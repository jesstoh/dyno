<!DOCTYPE html>
<html lang="en">
    <head>
        <%- include("../../partials/head.ejs") %>
        <link rel="stylesheet" href="/css/post_show.css">
        <script src="/js/post_show.js"></script>
    </head>
    <body>
        <header>
            <%- include("../../partials/nav.ejs") %>
            
        </header>
        <main class="section">
            <%- include("../../partials/main.ejs") %>
            <div class="row">
                <div class="col s2">
                    <button class="btn goback blue"><i class="material-icons">keyboard_backspace</i></a></button>
                </div>
                <div class="col s8">
                    <div class="card hoverable">                      
                        <div class="card-image">
                            <% if (post.img) {%>
                                <img src="<%=post.img%>" alt="">
                            <%} else {%>
                                <div class="video-container">
                                    <iframe src="<%=post.video%>" frameborder="0" allowfullscreen></iframe>
                                </div>
                                
                            <%}%>
                        </div>
                        <div class="card-content">
                            <div>
                                <% if (!post.likes.includes(currentUser.username)) {%>
                                    <i class="material-icons" id="like">favorite_border</i> 
                                <%} else {%>
                                    <i class="material-icons red-text" id="like">favorite</i> 
                                <%}%>
                                
                                <i class="material-icons" id="comment">chat_bubble_outline</i>
                                <span class="right">by <a href="/users/<%=post.author%>"><%=post.author%></a></span>
                            </div>
                            <span><strong><%=post.likes.length%> Likes</strong>  </span>
                            <span class="comment-show"><strong><%=post.comments.length%> Comments</strong> </span>
                            
                            <span class="right">location: <%=post.location%></span><br>
                            <p><%=post.description%></p>
                            
                            <span>tags: <%=post.tags%></span><br>
                            <span class="grey-text"><%=post.createdAt%></span>
                            
                            <% if (currentUser.username === post.author) {%>
                                <a href="/posts/<%=post._id%>/edit" class="btn-floating orange"><i class="material-icons">edit</i></a>
                            <%}%>
                            
                        </div>
                        <div class="card-action comment-box">
                            <div class="row">
                                <form action="/posts/<%=post._id%>/comment" method="POST">
                                    <textarea name="message" id="message" placeholder="Add a comment" required></textarea> 
                                    <button class="btn-small blue grey right" id="cancel-button">Cancel</button>                                  
                                    <input type="submit" class="btn-small blue right" value="POST">
                                    
                                    
                                </form>                              
                            </div>
                            
                        </div>
                        <div class="main-comments-container card-content">
                            <% post.comments.forEach(comment => {%>
                                <div class="comment-container">
                                    <a href="/users/<%=comment.user%>"><%=comment.user%> </a> <span class="grey-text comment-date"><%=comment.createdAt%></span> <br>
                                    <span class="comment-details"><%=comment.message%></span>
                                    
                                </div>

                            <%})%>

                        </div>
                    </div>
                </div>
            </div>
                
        </main>
        <footer>
            <%- include("../../partials/footer.ejs") %>
        </footer>

    </body>
</html>