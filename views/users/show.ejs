<!DOCTYPE html>
<html lang="en">
    <head>
        <%- include("../partials/head.ejs") %>
        <script src="/js/posts.js"></script>
        <script src="/js/user_show.js"></script>
    </head>
    <body>
        <header>
            <%- include("../partials/nav.ejs") %>
        </header>
        <main>
            <%- include("../partials/main.ejs") %>
            <section class="container section profile-container">
                <div class="row">
                    <div class="col s12 center">
                        <img src="<%=user.img%>" class="circle responsive-img" id="profile-pic" width="150">
                    </div>
                </div>
                <div class="col s12 center">
                    <%=user.username%>
                </div>    
                <div class="row">
                    <div class="col s4">
                        <%=posts.length%> Posts
                    </div>
                    <div class="col s4">
                        <a href="#followers" class="modal-trigger"><%=user.followers.length%></a> Followers
                    </div>
                    <div class="col s4">
                        <a href="#following" class="modal-trigger"><%=user.following.length%></a> Following
                    </div>
                </div>
                <div class="row">
                    <div class="col s12 center">
                        <% if (currentUser.username === user.username) {%>
                        
                            <a href="/accounts/edit" class="btn grey"><i class="material-icons left">edit</i>Edit Profile</a>
                        
                        <%} else if (currentUser.following.includes(user.username)) {%>
                            <form action="/users/<%=user.username%>/unfollow?_method=PUT" method="POST">
                                <input type="submit" class="btn blue following-btn" value="Following">
                            </form>
                        <%} else {%>
                            <form action="/users/<%=user.username%>/follow?_method=PUT" method="POST">
                                <button type="submit" class="btn blue">
                                    <% if (currentUser.followers.includes(user.username)) {%>
                                        Follow Back
                                    <%} else { %>
                                        Follow
                                    <%}%>

                                </button>
                            </form>
                        <%}%>  
                    </div>
                                      
                </div>
            </section>
            
            <section class="container post-container section">
                <div class="row">
                    <% posts.forEach(post => { %>
                        <div class="col s4 m3">
                            <div class="card hoverable post-card">
                                <a href="/posts/<%=post._id%>" class="post-link"></a>
                                <div class="card-image">
                                    <% if (post.img) {%>
                                        <img src="<%=post.img%>" alt="">
                                    <%} else {%>
                                        <div class="video-container">
                                            <iframe src="<%=post.video%>" frameborder="0" allowfullscreen></iframe>
                                        </div>
                                        
                                    <%}%>
                                </div>
                                
                            </div>
                        </div>
                                
                    <%})%>
                    
                </div>
            </section>

            <div class="modal" id="followers">
                
                <div class="modal-content">
                    <div class="modal-footer">
                        <a href="#" class="modal-close modal-action right"><i class="material-icons">close</i></a>
                    </div>
                    <h6 class="center-align"><strong>Followers</strong></h6>
                    <ul class="collection">
                        <% user.followers.forEach(follower => {%>
                            <li class="collection-item">
                                <a href="/users/<%=follower%>"><%=follower%></a>
                            </li>
                        <%})%>

                    </ul>
                    
                </div>
            </div>
            

        
            <div class="modal" id="following">
    
                <div class="modal-content">
                    <div class="modal-footer">
                        <a href="#" class="modal-close modal-action right"><i class="material-icons">close</i></a>
                    </div>
                    
                    
                    <h6 class="center-align"><strong>Following</strong></h6>
                    <ul class="collection">
                        <% user.following.forEach(followingUser => {%>
                            <li class="collection-item">
                                <a href="/users/<%=followingUser%>"><%=followingUser%></a>
                            </li>
                        <%})%>

                    </ul>
                    
                </div>
            </div>
        </main>
        <footer>
            <%- include("../partials/footer.ejs") %>
        </footer>
    </body>
</html>