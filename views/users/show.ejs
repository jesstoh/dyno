<!DOCTYPE html>
<html lang="en">
    <head>
        <%- include("../partials/head.ejs") %>
        <script src="/js/posts.js"></script>
    </head>
    <body>
        <header>
            <%- include("../partials/nav.ejs") %>
        </header>
        <main>
            <%- include("../partials/main.ejs") %>
            <section class="container section">
                <div class="row">
                    <div class="col s12 center">
                        <img src="<%=user.img%>" class="circle responsive-img" id="profile-pic" width="150">
                    </div>
                </div>
                <div class="col s12 center">
                    <%=user.username%>
                </div>    
                <div class="row">
                    <div class="col s4">
                        <%=posts.length%> Posts
                    </div>
                    <div class="col s4">
                        <%=user.followers.length%> Followers
                    </div>
                    <div class="col s4">
                        <%=user.following.length%> Following
                    </div>
                </div>
                <div class="row">
                    <div class="col s12 center">
                        <% if (currentUser.username === user.username) {%>
                        
                            <a href="/accounts/edit" class="btn grey"><i class="material-icons left">edit</i>Edit Profile</a>
                        
                        <%} else if (user.username in currentUser.following) {%>
                            <form action="/users/<%=user.username%>/unfollow?_method=PUT" method="POST">
                                <input type="submit" class="btn blue following-btn" value="Following">
                            </form>
                        <%} else {%>
                            <form action="/users/<%=user.username%>/follow?_method=PUT" method="POST">
                                <button type="submit" class="btn blue">
                                    <% if (user.username in currentUser.followers) {%>
                                        Follow Back
                                    <%} else { %>
                                        Follow
                                    <%}%>

                                </button>
                            </form>
                        <%}%>  
                    </div>
                                      
                </div>
            </section>
            
            <section class="container post-container section">
                <div class="row">
                    <% posts.forEach(post => { %>
                        <div class="col s4 m3">
                            <div class="card hoverable post-card">
                                <a href="/posts/<%=post._id%>" class="post-link"></a>
                                <div class="card-image">
                                    <% if (post.img) {%>
                                        <img src="<%=post.img%>" alt="">
                                    <%} else {%>
                                        <div class="video-container">
                                            <iframe src="<%=post.video%>" frameborder="0" allowfullscreen></iframe>
                                          </div>
                                        
                                    <%}%>
                                </div>
                                
                            </div>
                        </div>
                                
                    <%})%>
                    
                </div>
            </div>

        </main>
        <footer>

        </footer>
        
    </body>
</html>